import os, sys
import subprocess

###############################
rootDir = sys.argv[1]
bmName = sys.argv[2]
numFIGroups = int(sys.argv[3])
maxFIperGroup = int(sys.argv[4])
# noOfThreads = int(sys.argv[2])
###############################

curDir = os.getcwd()
rootDirAbs = os.path.realpath(rootDir)
# os.chdir(rootDir)
# Read input list
inputList = open('input_list.txt', 'r').readlines()

for eachInput in inputList:
	if eachInput != "\n":
		# Launch FI for the input
		eachInput = eachInput.replace("\n", "")
		overall_output_filepath = "overall-output/overall-failure-rates-summary-{}.log".format(eachInput.strip().replace(" ", "-"))

		if os.path.isfile(overall_output_filepath) and os.path.getsize(overall_output_filepath) > 0:
			fi_summary = open(overall_output_filepath, 'r').readlines()
			totalFi = int(fi_summary[0].split(":")[1].split("=")[0].split("/")[1])
			if totalFi >= 1500:
				print("Already measured the overall SDC for input: {}".format(eachInput))
				continue
		
		print("Now measuring overall SDC for input: {}".format(eachInput))

		inputFolderName = bmName + "-" + eachInput.replace(" ", "-")
		inputFolderPath = os.path.join(rootDirAbs, inputFolderName)
		os.system("python getFailureRates.py " + inputFolderPath + " " + bmName + " " + str(numFIGroups) + " " + str(maxFIperGroup) + " \"" + eachInput + "\"")
		print("measurement done for input: " + eachInput)

os.chdir(curDir)

